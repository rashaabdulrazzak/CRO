{"version":3,"file":"wslink.js","mappings":"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","sources":["webpack://wslink/webpack/universalModuleDefinition","webpack://wslink/webpack/bootstrap","webpack://wslink/webpack/runtime/define property getters","webpack://wslink/webpack/runtime/hasOwnProperty shorthand","webpack://wslink/webpack/runtime/make namespace object","webpack://wslink/./src/CompositeClosureHelper/index.js","webpack://wslink/./src/ProcessLauncher/index.js","webpack://wslink/./src/WebsocketConnection/chunking.js","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/utils/prettyByte.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/ExtData.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/DecodeError.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/utils/int.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/timestamp.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/utils/utf8.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/ExtensionCodec.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/utils/typedArrays.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/CachedKeyDecoder.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/Decoder.mjs","webpack://wslink/./node_modules/@msgpack/msgpack/dist.es5+esm/Encoder.mjs","webpack://wslink/./src/WebsocketConnection/session.js","webpack://wslink/./src/WebsocketConnection/index.js","webpack://wslink/./src/SmartConnect/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"wslink\"] = factory();\n\telse\n\t\troot[\"wslink\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// ----------------------------------------------------------------------------\n// capitalize provided string\n// ----------------------------------------------------------------------------\n\nexport function capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n// ----------------------------------------------------------------------------\n// Add isA function and register your class name\n// ----------------------------------------------------------------------------\n\nfunction isA(publicAPI, model = {}, name = null) {\n  if (!model.isA) {\n    model.isA = [];\n  }\n\n  if (name) {\n    model.isA.push(name);\n  }\n\n  if (!publicAPI.isA) {\n    publicAPI.isA = (className) => model.isA.indexOf(className) !== -1;\n  }\n}\n\n// ----------------------------------------------------------------------------\n// Basic setter\n// ----------------------------------------------------------------------------\n\nfunction set(publicAPI, model = {}, names = []) {\n  names.forEach((name) => {\n    publicAPI[`set${capitalize(name)}`] = (value) => {\n      model[name] = value;\n    };\n  });\n}\n\n// ----------------------------------------------------------------------------\n// Basic getter\n// ----------------------------------------------------------------------------\n\nfunction get(publicAPI, model = {}, names = []) {\n  names.forEach((name) => {\n    publicAPI[`get${capitalize(name)}`] = () => model[name];\n  });\n}\n\n// ----------------------------------------------------------------------------\n// Add destroy function\n// ----------------------------------------------------------------------------\n\nfunction destroy(publicAPI, model = {}) {\n  const previousDestroy = publicAPI.destroy;\n\n  if (!model.subscriptions) {\n    model.subscriptions = [];\n  }\n\n  publicAPI.destroy = () => {\n    if (previousDestroy) {\n      previousDestroy();\n    }\n    while (model.subscriptions && model.subscriptions.length) {\n      model.subscriptions.pop().unsubscribe();\n    }\n    Object.keys(model).forEach((field) => {\n      delete model[field];\n    });\n\n    // Flag the instance beeing deleted\n    model.deleted = true;\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Event handling: onXXX(callback), fireXXX(args...)\n// ----------------------------------------------------------------------------\n\nfunction event(publicAPI, model, eventName, asynchrounous = true) {\n  const callbacks = [];\n  const previousDestroy = publicAPI.destroy;\n\n  function off(index) {\n    callbacks[index] = null;\n  }\n\n  function on(index) {\n    function unsubscribe() {\n      off(index);\n    }\n    return Object.freeze({ unsubscribe });\n  }\n\n  publicAPI[`fire${capitalize(eventName)}`] = (...args) => {\n    if (model.deleted) {\n      console.log('instance deleted - can not call any method');\n      return;\n    }\n\n    function processCallbacks() {\n      callbacks.forEach((callback) => {\n        if (callback) {\n          try {\n            callback.apply(publicAPI, args);\n          } catch (errObj) {\n            console.log('Error event:', eventName, errObj);\n          }\n        }\n      });\n    }\n\n    if (asynchrounous) {\n      setTimeout(processCallbacks, 0);\n    } else {\n      processCallbacks();\n    }\n  };\n\n  publicAPI[`on${capitalize(eventName)}`] = (callback) => {\n    if (model.deleted) {\n      console.log('instance deleted - can not call any method');\n      return null;\n    }\n\n    const index = callbacks.length;\n    callbacks.push(callback);\n    return on(index);\n  };\n\n  publicAPI.destroy = () => {\n    previousDestroy();\n    callbacks.forEach((el, index) => off(index));\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Chain function calls\n// ----------------------------------------------------------------------------\n\nfunction chain(...fn) {\n  return (...args) => fn.filter((i) => !!i).forEach((i) => i(...args));\n}\n\n// ----------------------------------------------------------------------------\n// newInstance\n// ----------------------------------------------------------------------------\n\nfunction newInstance(extend) {\n  return (initialValues = {}) => {\n    const model = {};\n    const publicAPI = {};\n    extend(publicAPI, model, initialValues);\n    return Object.freeze(publicAPI);\n  };\n}\n\nexport default {\n  chain,\n  destroy,\n  event,\n  get,\n  isA,\n  newInstance,\n  set,\n};\n","/* global XMLHttpRequest */\nimport CompositeClosureHelper from '../CompositeClosureHelper';\n\nconst connections = [];\n\nfunction ProcessLauncher(publicAPI, model) {\n  publicAPI.start = (config) => {\n    const xhr = new XMLHttpRequest();\n    const url = model.endPoint;\n    if (!model._retry) {\n      model._retry = config.launcherRetry || [];\n    }\n\n    xhr.open('POST', url, true);\n\n    if (config.headers) {\n      model._headers = config.headers;\n      delete config.headers;\n    }\n    if (model._headers) {\n      Object.entries(model._headers).forEach(([key, value]) =>\n        xhr.setRequestHeader(key, value)\n      );\n    }\n\n    xhr.responseType = 'json';\n    const supportsJson = 'response' in xhr && xhr.responseType === 'json';\n\n    xhr.onload = (e) => {\n      const response = supportsJson ? xhr.response : JSON.parse(xhr.response);\n      if (xhr.status === 200 && response && !response.error) {\n        // Add connection to our global list\n        connections.push(response);\n        publicAPI.fireProcessReady(response);\n        return;\n      } else if (xhr.status === 503 && model._retry.length > 0) {\n        const timeout = model._retry.shift();\n        setTimeout(publicAPI.start, timeout, config);\n      } else {\n        publicAPI.fireError(xhr);\n      }\n    };\n\n    xhr.onerror = (e) => {\n      publicAPI.fireError(xhr);\n    };\n\n    xhr.send(JSON.stringify(config));\n  };\n\n  publicAPI.fetchConnection = (sessionId) => {\n    var xhr = new XMLHttpRequest(),\n      url = [model.endPoint, sessionId].join('/');\n\n    xhr.open('GET', url, true);\n    xhr.responseType = 'json';\n    const supportsJson = 'response' in xhr && xhr.responseType === 'json';\n\n    xhr.onload = (e) => {\n      if (this.status === 200) {\n        publicAPI.fireFetch(\n          supportsJson ? xhr.response : JSON.parse(xhr.response)\n        );\n        return;\n      }\n      publicAPI.fireError(xhr);\n    };\n\n    xhr.onerror = (e) => {\n      publicAPI.fireError(xhr);\n    };\n\n    xhr.send();\n  };\n\n  publicAPI.stop = (connection) => {\n    var xhr = new XMLHttpRequest(),\n      url = [model.endPoint, connection.id].join('/');\n\n    xhr.open('DELETE', url, true);\n    xhr.responseType = 'json';\n    const supportsJson = 'response' in xhr && xhr.responseType === 'json';\n\n    xhr.onload = (e) => {\n      if (this.status === 200) {\n        const response = supportsJson ? xhr.response : JSON.parse(xhr.response);\n        // Remove connection from the list\n        // FIXME / TODO\n        publicAPI.fireProcessStopped(response);\n        return;\n      }\n      publicAPI.fireError(xhr);\n    };\n    xhr.onerror = (e) => {\n      publicAPI.fireError(xhr);\n    };\n    xhr.send();\n  };\n\n  publicAPI.listConnections = () => {\n    return connections;\n  };\n}\n\nconst DEFAULT_VALUES = {\n  endPoint: null,\n};\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  CompositeClosureHelper.destroy(publicAPI, model);\n  CompositeClosureHelper.event(publicAPI, model, 'ProcessReady');\n  CompositeClosureHelper.event(publicAPI, model, 'ProcessStopped');\n  CompositeClosureHelper.event(publicAPI, model, 'Fetch');\n  CompositeClosureHelper.event(publicAPI, model, 'Error');\n  CompositeClosureHelper.isA(publicAPI, model, 'ProcessLauncher');\n\n  ProcessLauncher(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\nexport const newInstance = CompositeClosureHelper.newInstance(extend);\n\nexport default { newInstance, extend };\n","// Project not setup for typescript, manually compiling this file to chunker.js\n// npx tsc chunking.ts --target esnext\nconst UINT32_LENGTH = 4;\nconst ID_LOCATION = 0;\nconst ID_LENGTH = UINT32_LENGTH;\nconst MESSAGE_OFFSET_LOCATION = ID_LOCATION + ID_LENGTH;\nconst MESSAGE_OFFSET_LENGTH = UINT32_LENGTH;\nconst MESSAGE_SIZE_LOCATION = MESSAGE_OFFSET_LOCATION + MESSAGE_OFFSET_LENGTH;\nconst MESSAGE_SIZE_LENGTH = UINT32_LENGTH;\nconst HEADER_LENGTH = ID_LENGTH + MESSAGE_OFFSET_LENGTH + MESSAGE_SIZE_LENGTH;\nfunction encodeHeader(id, offset, size) {\n  const buffer = new ArrayBuffer(HEADER_LENGTH);\n  const header = new Uint8Array(buffer);\n  const view = new DataView(buffer);\n  view.setUint32(ID_LOCATION, id, true);\n  view.setUint32(MESSAGE_OFFSET_LOCATION, offset, true);\n  view.setUint32(MESSAGE_SIZE_LOCATION, size, true);\n  return header;\n}\nfunction decodeHeader(header) {\n  const view = new DataView(header.buffer);\n  const id = view.getUint32(ID_LOCATION, true);\n  const offset = view.getUint32(MESSAGE_OFFSET_LOCATION, true);\n  const size = view.getUint32(MESSAGE_SIZE_LOCATION, true);\n  return { id, offset, size };\n}\nfunction* generateChunks(message, maxSize) {\n  const totalSize = message.byteLength;\n  let maxContentSize;\n  if (maxSize === 0) {\n    maxContentSize = totalSize;\n  } else {\n    maxContentSize = Math.max(maxSize - HEADER_LENGTH, 1);\n  }\n  const id = new Uint32Array(1);\n  crypto.getRandomValues(id);\n  let offset = 0;\n  while (offset < totalSize) {\n    const contentSize = Math.min(maxContentSize, totalSize - offset);\n    const chunk = new Uint8Array(new ArrayBuffer(HEADER_LENGTH + contentSize));\n    const header = encodeHeader(id[0], offset, totalSize);\n    chunk.set(new Uint8Array(header.buffer), 0);\n    chunk.set(message.subarray(offset, offset + contentSize), HEADER_LENGTH);\n    yield chunk;\n    offset += contentSize;\n  }\n  return;\n}\n/*\n  This un-chunker is vulnerable to DOS.\n  If it receives a message with a header claiming a large incoming message\n  it will allocate the memory blindly even without actually receiving the content\n  Chunks for a given message can come in any order\n  Chunks across messages can be interleaved.\n*/\nclass UnChunker {\n  pendingMessages;\n  constructor() {\n    this.pendingMessages = {};\n  }\n  releasePendingMessages() {\n    this.pendingMessages = {};\n  }\n  async processChunk(chunk, decoderFactory) {\n    const headerBlob = chunk.slice(0, HEADER_LENGTH);\n    const contentBlob = chunk.slice(HEADER_LENGTH);\n    const header = new Uint8Array(await headerBlob.arrayBuffer());\n    const { id, offset, size: totalSize } = decodeHeader(header);\n    let pendingMessage = this.pendingMessages[id];\n    if (!pendingMessage) {\n      pendingMessage = {\n        receivedSize: 0,\n        content: new Uint8Array(totalSize),\n        decoder: decoderFactory(),\n      };\n      this.pendingMessages[id] = pendingMessage;\n    }\n    // This should never happen, but still check it\n    if (totalSize !== pendingMessage.content.byteLength) {\n      delete this.pendingMessages[id];\n      throw new Error(\n        `Total size in chunk header for message ${id} does not match total size declared by previous chunk.`\n      );\n    }\n    const chunkContent = new Uint8Array(await contentBlob.arrayBuffer());\n    const content = pendingMessage.content;\n    content.set(chunkContent, offset);\n    pendingMessage.receivedSize += chunkContent.byteLength;\n    if (pendingMessage.receivedSize >= totalSize) {\n      delete this.pendingMessages[id];\n      try {\n        return pendingMessage['decoder'].decode(content);\n      } catch (e) {\n        console.error('Malformed message: ', content.slice(0, 100));\n        // debugger;\n      }\n    }\n    return undefined;\n  }\n}\n// Makes sure messages are processed in order of arrival,\nexport class SequentialTaskQueue {\n  taskId;\n  pendingTaskId;\n  tasks;\n  constructor() {\n    this.taskId = 0;\n    this.pendingTaskId = -1;\n    this.tasks = {};\n  }\n  enqueue(fn, ...args) {\n    return new Promise((resolve, reject) => {\n      const taskId = this.taskId++;\n      this.tasks[taskId] = { fn, args, resolve, reject };\n      this._maybeExecuteNext();\n    });\n  }\n  _maybeExecuteNext() {\n    let pendingTask = this.tasks[this.pendingTaskId];\n    if (pendingTask) {\n      return;\n    }\n    const nextPendingTaskId = this.pendingTaskId + 1;\n    pendingTask = this.tasks[nextPendingTaskId];\n    if (!pendingTask) {\n      return;\n    }\n    this.pendingTaskId = nextPendingTaskId;\n    const { fn, args, resolve, reject } = pendingTask;\n    fn(...args)\n      .then((result) => {\n        resolve(result);\n        delete this.tasks[nextPendingTaskId];\n        this._maybeExecuteNext();\n      })\n      .catch((err) => {\n        reject(err);\n        delete this.tasks[nextPendingTaskId];\n        this._maybeExecuteNext();\n      });\n  }\n}\n/*\n  This un-chunker is more memory efficient\n  (each chunk is passed immediately to msgpack)\n  and it will only allocate memory when it receives content.\n  Chunks for a given message are expected to come sequentially\n  Chunks across messages can be interleaved.\n*/\nclass StreamUnChunker {\n  pendingMessages;\n  constructor() {\n    this.pendingMessages = {};\n  }\n  processChunk = async (chunk, decoderFactory) => {\n    const headerBlob = chunk.slice(0, HEADER_LENGTH);\n    const header = new Uint8Array(await headerBlob.arrayBuffer());\n    const { id, offset, size: totalSize } = decodeHeader(header);\n    const contentBlob = chunk.slice(HEADER_LENGTH);\n    let pendingMessage = this.pendingMessages[id];\n    if (!pendingMessage) {\n      pendingMessage = {\n        receivedSize: 0,\n        totalSize: totalSize,\n        decoder: decoderFactory(),\n      };\n      this.pendingMessages[id] = pendingMessage;\n    }\n    // This should never happen, but still check it\n    if (totalSize !== pendingMessage.totalSize) {\n      delete this.pendingMessages[id];\n      throw new Error(\n        `Total size in chunk header for message ${id} does not match total size declared by previous chunk.`\n      );\n    }\n    // This should never happen, but still check it\n    if (offset !== pendingMessage.receivedSize) {\n      delete this.pendingMessages[id];\n      throw new Error(`Received an unexpected chunk for message ${id}.\n           Expected offset = ${pendingMessage.receivedSize},\n           Received offset = ${offset}.`);\n    }\n    let result;\n    try {\n      result = await pendingMessage.decoder.decodeAsync(contentBlob.stream());\n    } catch (e) {\n      if (e instanceof RangeError) {\n        // More data is needed, it should come in the next chunk\n        result = undefined;\n      }\n    }\n    pendingMessage.receivedSize += contentBlob.size;\n    /*\n          In principle feeding a stream to the unpacker could yield multiple outputs\n          for example unpacker.feed(b'0123') would yield b'0', b'1', ect\n          or concatenated packed payloads would yield two or more unpacked objects\n          but in our use case we expect a full message to be mapped to a single object\n        */\n    if (result && pendingMessage.receivedSize < totalSize) {\n      delete this.pendingMessages[id];\n      throw new Error(`Received a parsable payload shorter than expected for message ${id}.\n           Expected size = ${totalSize},\n           Received size = ${pendingMessage.receivedSize}.`);\n    }\n    if (pendingMessage.receivedSize >= totalSize) {\n      delete this.pendingMessages[id];\n    }\n    return result;\n  };\n}\nexport { UnChunker, StreamUnChunker, generateChunks };\n","export function prettyByte(byte) {\n    return \"\".concat(byte < 0 ? \"-\" : \"\", \"0x\").concat(Math.abs(byte).toString(16).padStart(2, \"0\"));\n}\n//# sourceMappingURL=prettyByte.mjs.map","/**\n * ExtData is used to handle Extension Types that are not registered to ExtensionCodec.\n */\nvar ExtData = /** @class */ (function () {\n    function ExtData(type, data) {\n        this.type = type;\n        this.data = data;\n    }\n    return ExtData;\n}());\nexport { ExtData };\n//# sourceMappingURL=ExtData.mjs.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar DecodeError = /** @class */ (function (_super) {\n    __extends(DecodeError, _super);\n    function DecodeError(message) {\n        var _this = _super.call(this, message) || this;\n        // fix the prototype chain in a cross-platform way\n        var proto = Object.create(DecodeError.prototype);\n        Object.setPrototypeOf(_this, proto);\n        Object.defineProperty(_this, \"name\", {\n            configurable: true,\n            enumerable: false,\n            value: DecodeError.name,\n        });\n        return _this;\n    }\n    return DecodeError;\n}(Error));\nexport { DecodeError };\n//# sourceMappingURL=DecodeError.mjs.map","// Integer Utility\nexport var UINT32_MAX = 4294967295;\n// DataView extension to handle int64 / uint64,\n// where the actual range is 53-bits integer (a.k.a. safe integer)\nexport function setUint64(view, offset, value) {\n    var high = value / 4294967296;\n    var low = value; // high bits are truncated by DataView\n    view.setUint32(offset, high);\n    view.setUint32(offset + 4, low);\n}\nexport function setInt64(view, offset, value) {\n    var high = Math.floor(value / 4294967296);\n    var low = value; // high bits are truncated by DataView\n    view.setUint32(offset, high);\n    view.setUint32(offset + 4, low);\n}\nexport function getInt64(view, offset) {\n    var high = view.getInt32(offset);\n    var low = view.getUint32(offset + 4);\n    return high * 4294967296 + low;\n}\nexport function getUint64(view, offset) {\n    var high = view.getUint32(offset);\n    var low = view.getUint32(offset + 4);\n    return high * 4294967296 + low;\n}\n//# sourceMappingURL=int.mjs.map","// https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type\nimport { DecodeError } from \"./DecodeError.mjs\";\nimport { getInt64, setInt64 } from \"./utils/int.mjs\";\nexport var EXT_TIMESTAMP = -1;\nvar TIMESTAMP32_MAX_SEC = 0x100000000 - 1; // 32-bit unsigned int\nvar TIMESTAMP64_MAX_SEC = 0x400000000 - 1; // 34-bit unsigned int\nexport function encodeTimeSpecToTimestamp(_a) {\n    var sec = _a.sec, nsec = _a.nsec;\n    if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {\n        // Here sec >= 0 && nsec >= 0\n        if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {\n            // timestamp 32 = { sec32 (unsigned) }\n            var rv = new Uint8Array(4);\n            var view = new DataView(rv.buffer);\n            view.setUint32(0, sec);\n            return rv;\n        }\n        else {\n            // timestamp 64 = { nsec30 (unsigned), sec34 (unsigned) }\n            var secHigh = sec / 0x100000000;\n            var secLow = sec & 0xffffffff;\n            var rv = new Uint8Array(8);\n            var view = new DataView(rv.buffer);\n            // nsec30 | secHigh2\n            view.setUint32(0, (nsec << 2) | (secHigh & 0x3));\n            // secLow32\n            view.setUint32(4, secLow);\n            return rv;\n        }\n    }\n    else {\n        // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n        var rv = new Uint8Array(12);\n        var view = new DataView(rv.buffer);\n        view.setUint32(0, nsec);\n        setInt64(view, 4, sec);\n        return rv;\n    }\n}\nexport function encodeDateToTimeSpec(date) {\n    var msec = date.getTime();\n    var sec = Math.floor(msec / 1e3);\n    var nsec = (msec - sec * 1e3) * 1e6;\n    // Normalizes { sec, nsec } to ensure nsec is unsigned.\n    var nsecInSec = Math.floor(nsec / 1e9);\n    return {\n        sec: sec + nsecInSec,\n        nsec: nsec - nsecInSec * 1e9,\n    };\n}\nexport function encodeTimestampExtension(object) {\n    if (object instanceof Date) {\n        var timeSpec = encodeDateToTimeSpec(object);\n        return encodeTimeSpecToTimestamp(timeSpec);\n    }\n    else {\n        return null;\n    }\n}\nexport function decodeTimestampToTimeSpec(data) {\n    var view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n    // data may be 32, 64, or 96 bits\n    switch (data.byteLength) {\n        case 4: {\n            // timestamp 32 = { sec32 }\n            var sec = view.getUint32(0);\n            var nsec = 0;\n            return { sec: sec, nsec: nsec };\n        }\n        case 8: {\n            // timestamp 64 = { nsec30, sec34 }\n            var nsec30AndSecHigh2 = view.getUint32(0);\n            var secLow32 = view.getUint32(4);\n            var sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;\n            var nsec = nsec30AndSecHigh2 >>> 2;\n            return { sec: sec, nsec: nsec };\n        }\n        case 12: {\n            // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n            var sec = getInt64(view, 4);\n            var nsec = view.getUint32(0);\n            return { sec: sec, nsec: nsec };\n        }\n        default:\n            throw new DecodeError(\"Unrecognized data size for timestamp (expected 4, 8, or 12): \".concat(data.length));\n    }\n}\nexport function decodeTimestampExtension(data) {\n    var timeSpec = decodeTimestampToTimeSpec(data);\n    return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);\n}\nexport var timestampExtension = {\n    type: EXT_TIMESTAMP,\n    encode: encodeTimestampExtension,\n    decode: decodeTimestampExtension,\n};\n//# sourceMappingURL=timestamp.mjs.map","var _a, _b, _c;\n/* eslint-disable @typescript-eslint/no-unnecessary-condition */\nimport { UINT32_MAX } from \"./int.mjs\";\nvar TEXT_ENCODING_AVAILABLE = (typeof process === \"undefined\" || ((_a = process === null || process === void 0 ? void 0 : process.env) === null || _a === void 0 ? void 0 : _a[\"TEXT_ENCODING\"]) !== \"never\") &&\n    typeof TextEncoder !== \"undefined\" &&\n    typeof TextDecoder !== \"undefined\";\nexport function utf8Count(str) {\n    var strLength = str.length;\n    var byteLength = 0;\n    var pos = 0;\n    while (pos < strLength) {\n        var value = str.charCodeAt(pos++);\n        if ((value & 0xffffff80) === 0) {\n            // 1-byte\n            byteLength++;\n            continue;\n        }\n        else if ((value & 0xfffff800) === 0) {\n            // 2-bytes\n            byteLength += 2;\n        }\n        else {\n            // handle surrogate pair\n            if (value >= 0xd800 && value <= 0xdbff) {\n                // high surrogate\n                if (pos < strLength) {\n                    var extra = str.charCodeAt(pos);\n                    if ((extra & 0xfc00) === 0xdc00) {\n                        ++pos;\n                        value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n                    }\n                }\n            }\n            if ((value & 0xffff0000) === 0) {\n                // 3-byte\n                byteLength += 3;\n            }\n            else {\n                // 4-byte\n                byteLength += 4;\n            }\n        }\n    }\n    return byteLength;\n}\nexport function utf8EncodeJs(str, output, outputOffset) {\n    var strLength = str.length;\n    var offset = outputOffset;\n    var pos = 0;\n    while (pos < strLength) {\n        var value = str.charCodeAt(pos++);\n        if ((value & 0xffffff80) === 0) {\n            // 1-byte\n            output[offset++] = value;\n            continue;\n        }\n        else if ((value & 0xfffff800) === 0) {\n            // 2-bytes\n            output[offset++] = ((value >> 6) & 0x1f) | 0xc0;\n        }\n        else {\n            // handle surrogate pair\n            if (value >= 0xd800 && value <= 0xdbff) {\n                // high surrogate\n                if (pos < strLength) {\n                    var extra = str.charCodeAt(pos);\n                    if ((extra & 0xfc00) === 0xdc00) {\n                        ++pos;\n                        value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n                    }\n                }\n            }\n            if ((value & 0xffff0000) === 0) {\n                // 3-byte\n                output[offset++] = ((value >> 12) & 0x0f) | 0xe0;\n                output[offset++] = ((value >> 6) & 0x3f) | 0x80;\n            }\n            else {\n                // 4-byte\n                output[offset++] = ((value >> 18) & 0x07) | 0xf0;\n                output[offset++] = ((value >> 12) & 0x3f) | 0x80;\n                output[offset++] = ((value >> 6) & 0x3f) | 0x80;\n            }\n        }\n        output[offset++] = (value & 0x3f) | 0x80;\n    }\n}\nvar sharedTextEncoder = TEXT_ENCODING_AVAILABLE ? new TextEncoder() : undefined;\nexport var TEXT_ENCODER_THRESHOLD = !TEXT_ENCODING_AVAILABLE\n    ? UINT32_MAX\n    : typeof process !== \"undefined\" && ((_b = process === null || process === void 0 ? void 0 : process.env) === null || _b === void 0 ? void 0 : _b[\"TEXT_ENCODING\"]) !== \"force\"\n        ? 200\n        : 0;\nfunction utf8EncodeTEencode(str, output, outputOffset) {\n    output.set(sharedTextEncoder.encode(str), outputOffset);\n}\nfunction utf8EncodeTEencodeInto(str, output, outputOffset) {\n    sharedTextEncoder.encodeInto(str, output.subarray(outputOffset));\n}\nexport var utf8EncodeTE = (sharedTextEncoder === null || sharedTextEncoder === void 0 ? void 0 : sharedTextEncoder.encodeInto) ? utf8EncodeTEencodeInto : utf8EncodeTEencode;\nvar CHUNK_SIZE = 4096;\nexport function utf8DecodeJs(bytes, inputOffset, byteLength) {\n    var offset = inputOffset;\n    var end = offset + byteLength;\n    var units = [];\n    var result = \"\";\n    while (offset < end) {\n        var byte1 = bytes[offset++];\n        if ((byte1 & 0x80) === 0) {\n            // 1 byte\n            units.push(byte1);\n        }\n        else if ((byte1 & 0xe0) === 0xc0) {\n            // 2 bytes\n            var byte2 = bytes[offset++] & 0x3f;\n            units.push(((byte1 & 0x1f) << 6) | byte2);\n        }\n        else if ((byte1 & 0xf0) === 0xe0) {\n            // 3 bytes\n            var byte2 = bytes[offset++] & 0x3f;\n            var byte3 = bytes[offset++] & 0x3f;\n            units.push(((byte1 & 0x1f) << 12) | (byte2 << 6) | byte3);\n        }\n        else if ((byte1 & 0xf8) === 0xf0) {\n            // 4 bytes\n            var byte2 = bytes[offset++] & 0x3f;\n            var byte3 = bytes[offset++] & 0x3f;\n            var byte4 = bytes[offset++] & 0x3f;\n            var unit = ((byte1 & 0x07) << 0x12) | (byte2 << 0x0c) | (byte3 << 0x06) | byte4;\n            if (unit > 0xffff) {\n                unit -= 0x10000;\n                units.push(((unit >>> 10) & 0x3ff) | 0xd800);\n                unit = 0xdc00 | (unit & 0x3ff);\n            }\n            units.push(unit);\n        }\n        else {\n            units.push(byte1);\n        }\n        if (units.length >= CHUNK_SIZE) {\n            result += String.fromCharCode.apply(String, units);\n            units.length = 0;\n        }\n    }\n    if (units.length > 0) {\n        result += String.fromCharCode.apply(String, units);\n    }\n    return result;\n}\nvar sharedTextDecoder = TEXT_ENCODING_AVAILABLE ? new TextDecoder() : null;\nexport var TEXT_DECODER_THRESHOLD = !TEXT_ENCODING_AVAILABLE\n    ? UINT32_MAX\n    : typeof process !== \"undefined\" && ((_c = process === null || process === void 0 ? void 0 : process.env) === null || _c === void 0 ? void 0 : _c[\"TEXT_DECODER\"]) !== \"force\"\n        ? 200\n        : 0;\nexport function utf8DecodeTD(bytes, inputOffset, byteLength) {\n    var stringBytes = bytes.subarray(inputOffset, inputOffset + byteLength);\n    return sharedTextDecoder.decode(stringBytes);\n}\n//# sourceMappingURL=utf8.mjs.map","// ExtensionCodec to handle MessagePack extensions\nimport { ExtData } from \"./ExtData.mjs\";\nimport { timestampExtension } from \"./timestamp.mjs\";\nvar ExtensionCodec = /** @class */ (function () {\n    function ExtensionCodec() {\n        // built-in extensions\n        this.builtInEncoders = [];\n        this.builtInDecoders = [];\n        // custom extensions\n        this.encoders = [];\n        this.decoders = [];\n        this.register(timestampExtension);\n    }\n    ExtensionCodec.prototype.register = function (_a) {\n        var type = _a.type, encode = _a.encode, decode = _a.decode;\n        if (type >= 0) {\n            // custom extensions\n            this.encoders[type] = encode;\n            this.decoders[type] = decode;\n        }\n        else {\n            // built-in extensions\n            var index = 1 + type;\n            this.builtInEncoders[index] = encode;\n            this.builtInDecoders[index] = decode;\n        }\n    };\n    ExtensionCodec.prototype.tryToEncode = function (object, context) {\n        // built-in extensions\n        for (var i = 0; i < this.builtInEncoders.length; i++) {\n            var encodeExt = this.builtInEncoders[i];\n            if (encodeExt != null) {\n                var data = encodeExt(object, context);\n                if (data != null) {\n                    var type = -1 - i;\n                    return new ExtData(type, data);\n                }\n            }\n        }\n        // custom extensions\n        for (var i = 0; i < this.encoders.length; i++) {\n            var encodeExt = this.encoders[i];\n            if (encodeExt != null) {\n                var data = encodeExt(object, context);\n                if (data != null) {\n                    var type = i;\n                    return new ExtData(type, data);\n                }\n            }\n        }\n        if (object instanceof ExtData) {\n            // to keep ExtData as is\n            return object;\n        }\n        return null;\n    };\n    ExtensionCodec.prototype.decode = function (data, type, context) {\n        var decodeExt = type < 0 ? this.builtInDecoders[-1 - type] : this.decoders[type];\n        if (decodeExt) {\n            return decodeExt(data, type, context);\n        }\n        else {\n            // decode() does not fail, returns ExtData instead.\n            return new ExtData(type, data);\n        }\n    };\n    ExtensionCodec.defaultCodec = new ExtensionCodec();\n    return ExtensionCodec;\n}());\nexport { ExtensionCodec };\n//# sourceMappingURL=ExtensionCodec.mjs.map","export function ensureUint8Array(buffer) {\n    if (buffer instanceof Uint8Array) {\n        return buffer;\n    }\n    else if (ArrayBuffer.isView(buffer)) {\n        return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n    }\n    else if (buffer instanceof ArrayBuffer) {\n        return new Uint8Array(buffer);\n    }\n    else {\n        // ArrayLike<number>\n        return Uint8Array.from(buffer);\n    }\n}\nexport function createDataView(buffer) {\n    if (buffer instanceof ArrayBuffer) {\n        return new DataView(buffer);\n    }\n    var bufferView = ensureUint8Array(buffer);\n    return new DataView(bufferView.buffer, bufferView.byteOffset, bufferView.byteLength);\n}\n//# sourceMappingURL=typedArrays.mjs.map","import { utf8DecodeJs } from \"./utils/utf8.mjs\";\nvar DEFAULT_MAX_KEY_LENGTH = 16;\nvar DEFAULT_MAX_LENGTH_PER_KEY = 16;\nvar CachedKeyDecoder = /** @class */ (function () {\n    function CachedKeyDecoder(maxKeyLength, maxLengthPerKey) {\n        if (maxKeyLength === void 0) { maxKeyLength = DEFAULT_MAX_KEY_LENGTH; }\n        if (maxLengthPerKey === void 0) { maxLengthPerKey = DEFAULT_MAX_LENGTH_PER_KEY; }\n        this.maxKeyLength = maxKeyLength;\n        this.maxLengthPerKey = maxLengthPerKey;\n        this.hit = 0;\n        this.miss = 0;\n        // avoid `new Array(N)`, which makes a sparse array,\n        // because a sparse array is typically slower than a non-sparse array.\n        this.caches = [];\n        for (var i = 0; i < this.maxKeyLength; i++) {\n            this.caches.push([]);\n        }\n    }\n    CachedKeyDecoder.prototype.canBeCached = function (byteLength) {\n        return byteLength > 0 && byteLength <= this.maxKeyLength;\n    };\n    CachedKeyDecoder.prototype.find = function (bytes, inputOffset, byteLength) {\n        var records = this.caches[byteLength - 1];\n        FIND_CHUNK: for (var _i = 0, records_1 = records; _i < records_1.length; _i++) {\n            var record = records_1[_i];\n            var recordBytes = record.bytes;\n            for (var j = 0; j < byteLength; j++) {\n                if (recordBytes[j] !== bytes[inputOffset + j]) {\n                    continue FIND_CHUNK;\n                }\n            }\n            return record.str;\n        }\n        return null;\n    };\n    CachedKeyDecoder.prototype.store = function (bytes, value) {\n        var records = this.caches[bytes.length - 1];\n        var record = { bytes: bytes, str: value };\n        if (records.length >= this.maxLengthPerKey) {\n            // `records` are full!\n            // Set `record` to an arbitrary position.\n            records[(Math.random() * records.length) | 0] = record;\n        }\n        else {\n            records.push(record);\n        }\n    };\n    CachedKeyDecoder.prototype.decode = function (bytes, inputOffset, byteLength) {\n        var cachedValue = this.find(bytes, inputOffset, byteLength);\n        if (cachedValue != null) {\n            this.hit++;\n            return cachedValue;\n        }\n        this.miss++;\n        var str = utf8DecodeJs(bytes, inputOffset, byteLength);\n        // Ensure to copy a slice of bytes because the byte may be NodeJS Buffer and Buffer#slice() returns a reference to its internal ArrayBuffer.\n        var slicedCopyOfBytes = Uint8Array.prototype.slice.call(bytes, inputOffset, inputOffset + byteLength);\n        this.store(slicedCopyOfBytes, str);\n        return str;\n    };\n    return CachedKeyDecoder;\n}());\nexport { CachedKeyDecoder };\n//# sourceMappingURL=CachedKeyDecoder.mjs.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __asyncValues = (this && this.__asyncValues) || function (o) {\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n    var m = o[Symbol.asyncIterator], i;\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n};\nvar __await = (this && this.__await) || function (v) { return this instanceof __await ? (this.v = v, this) : new __await(v); }\nvar __asyncGenerator = (this && this.__asyncGenerator) || function (thisArg, _arguments, generator) {\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n    function fulfill(value) { resume(\"next\", value); }\n    function reject(value) { resume(\"throw\", value); }\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n};\nimport { prettyByte } from \"./utils/prettyByte.mjs\";\nimport { ExtensionCodec } from \"./ExtensionCodec.mjs\";\nimport { getInt64, getUint64, UINT32_MAX } from \"./utils/int.mjs\";\nimport { utf8DecodeJs, TEXT_DECODER_THRESHOLD, utf8DecodeTD } from \"./utils/utf8.mjs\";\nimport { createDataView, ensureUint8Array } from \"./utils/typedArrays.mjs\";\nimport { CachedKeyDecoder } from \"./CachedKeyDecoder.mjs\";\nimport { DecodeError } from \"./DecodeError.mjs\";\nvar isValidMapKeyType = function (key) {\n    var keyType = typeof key;\n    return keyType === \"string\" || keyType === \"number\";\n};\nvar HEAD_BYTE_REQUIRED = -1;\nvar EMPTY_VIEW = new DataView(new ArrayBuffer(0));\nvar EMPTY_BYTES = new Uint8Array(EMPTY_VIEW.buffer);\n// IE11: Hack to support IE11.\n// IE11: Drop this hack and just use RangeError when IE11 is obsolete.\nexport var DataViewIndexOutOfBoundsError = (function () {\n    try {\n        // IE11: The spec says it should throw RangeError,\n        // IE11: but in IE11 it throws TypeError.\n        EMPTY_VIEW.getInt8(0);\n    }\n    catch (e) {\n        return e.constructor;\n    }\n    throw new Error(\"never reached\");\n})();\nvar MORE_DATA = new DataViewIndexOutOfBoundsError(\"Insufficient data\");\nvar sharedCachedKeyDecoder = new CachedKeyDecoder();\nvar Decoder = /** @class */ (function () {\n    function Decoder(extensionCodec, context, maxStrLength, maxBinLength, maxArrayLength, maxMapLength, maxExtLength, keyDecoder) {\n        if (extensionCodec === void 0) { extensionCodec = ExtensionCodec.defaultCodec; }\n        if (context === void 0) { context = undefined; }\n        if (maxStrLength === void 0) { maxStrLength = UINT32_MAX; }\n        if (maxBinLength === void 0) { maxBinLength = UINT32_MAX; }\n        if (maxArrayLength === void 0) { maxArrayLength = UINT32_MAX; }\n        if (maxMapLength === void 0) { maxMapLength = UINT32_MAX; }\n        if (maxExtLength === void 0) { maxExtLength = UINT32_MAX; }\n        if (keyDecoder === void 0) { keyDecoder = sharedCachedKeyDecoder; }\n        this.extensionCodec = extensionCodec;\n        this.context = context;\n        this.maxStrLength = maxStrLength;\n        this.maxBinLength = maxBinLength;\n        this.maxArrayLength = maxArrayLength;\n        this.maxMapLength = maxMapLength;\n        this.maxExtLength = maxExtLength;\n        this.keyDecoder = keyDecoder;\n        this.totalPos = 0;\n        this.pos = 0;\n        this.view = EMPTY_VIEW;\n        this.bytes = EMPTY_BYTES;\n        this.headByte = HEAD_BYTE_REQUIRED;\n        this.stack = [];\n    }\n    Decoder.prototype.reinitializeState = function () {\n        this.totalPos = 0;\n        this.headByte = HEAD_BYTE_REQUIRED;\n        this.stack.length = 0;\n        // view, bytes, and pos will be re-initialized in setBuffer()\n    };\n    Decoder.prototype.setBuffer = function (buffer) {\n        this.bytes = ensureUint8Array(buffer);\n        this.view = createDataView(this.bytes);\n        this.pos = 0;\n    };\n    Decoder.prototype.appendBuffer = function (buffer) {\n        if (this.headByte === HEAD_BYTE_REQUIRED && !this.hasRemaining(1)) {\n            this.setBuffer(buffer);\n        }\n        else {\n            var remainingData = this.bytes.subarray(this.pos);\n            var newData = ensureUint8Array(buffer);\n            // concat remainingData + newData\n            var newBuffer = new Uint8Array(remainingData.length + newData.length);\n            newBuffer.set(remainingData);\n            newBuffer.set(newData, remainingData.length);\n            this.setBuffer(newBuffer);\n        }\n    };\n    Decoder.prototype.hasRemaining = function (size) {\n        return this.view.byteLength - this.pos >= size;\n    };\n    Decoder.prototype.createExtraByteError = function (posToShow) {\n        var _a = this, view = _a.view, pos = _a.pos;\n        return new RangeError(\"Extra \".concat(view.byteLength - pos, \" of \").concat(view.byteLength, \" byte(s) found at buffer[\").concat(posToShow, \"]\"));\n    };\n    /**\n     * @throws {@link DecodeError}\n     * @throws {@link RangeError}\n     */\n    Decoder.prototype.decode = function (buffer) {\n        this.reinitializeState();\n        this.setBuffer(buffer);\n        var object = this.doDecodeSync();\n        if (this.hasRemaining(1)) {\n            throw this.createExtraByteError(this.pos);\n        }\n        return object;\n    };\n    Decoder.prototype.decodeMulti = function (buffer) {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    this.reinitializeState();\n                    this.setBuffer(buffer);\n                    _a.label = 1;\n                case 1:\n                    if (!this.hasRemaining(1)) return [3 /*break*/, 3];\n                    return [4 /*yield*/, this.doDecodeSync()];\n                case 2:\n                    _a.sent();\n                    return [3 /*break*/, 1];\n                case 3: return [2 /*return*/];\n            }\n        });\n    };\n    Decoder.prototype.decodeAsync = function (stream) {\n        var stream_1, stream_1_1;\n        var e_1, _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var decoded, object, buffer, e_1_1, _b, headByte, pos, totalPos;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        decoded = false;\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 6, 7, 12]);\n                        stream_1 = __asyncValues(stream);\n                        _c.label = 2;\n                    case 2: return [4 /*yield*/, stream_1.next()];\n                    case 3:\n                        if (!(stream_1_1 = _c.sent(), !stream_1_1.done)) return [3 /*break*/, 5];\n                        buffer = stream_1_1.value;\n                        if (decoded) {\n                            throw this.createExtraByteError(this.totalPos);\n                        }\n                        this.appendBuffer(buffer);\n                        try {\n                            object = this.doDecodeSync();\n                            decoded = true;\n                        }\n                        catch (e) {\n                            if (!(e instanceof DataViewIndexOutOfBoundsError)) {\n                                throw e; // rethrow\n                            }\n                            // fallthrough\n                        }\n                        this.totalPos += this.pos;\n                        _c.label = 4;\n                    case 4: return [3 /*break*/, 2];\n                    case 5: return [3 /*break*/, 12];\n                    case 6:\n                        e_1_1 = _c.sent();\n                        e_1 = { error: e_1_1 };\n                        return [3 /*break*/, 12];\n                    case 7:\n                        _c.trys.push([7, , 10, 11]);\n                        if (!(stream_1_1 && !stream_1_1.done && (_a = stream_1.return))) return [3 /*break*/, 9];\n                        return [4 /*yield*/, _a.call(stream_1)];\n                    case 8:\n                        _c.sent();\n                        _c.label = 9;\n                    case 9: return [3 /*break*/, 11];\n                    case 10:\n                        if (e_1) throw e_1.error;\n                        return [7 /*endfinally*/];\n                    case 11: return [7 /*endfinally*/];\n                    case 12:\n                        if (decoded) {\n                            if (this.hasRemaining(1)) {\n                                throw this.createExtraByteError(this.totalPos);\n                            }\n                            return [2 /*return*/, object];\n                        }\n                        _b = this, headByte = _b.headByte, pos = _b.pos, totalPos = _b.totalPos;\n                        throw new RangeError(\"Insufficient data in parsing \".concat(prettyByte(headByte), \" at \").concat(totalPos, \" (\").concat(pos, \" in the current buffer)\"));\n                }\n            });\n        });\n    };\n    Decoder.prototype.decodeArrayStream = function (stream) {\n        return this.decodeMultiAsync(stream, true);\n    };\n    Decoder.prototype.decodeStream = function (stream) {\n        return this.decodeMultiAsync(stream, false);\n    };\n    Decoder.prototype.decodeMultiAsync = function (stream, isArray) {\n        return __asyncGenerator(this, arguments, function decodeMultiAsync_1() {\n            var isArrayHeaderRequired, arrayItemsLeft, stream_2, stream_2_1, buffer, e_2, e_3_1;\n            var e_3, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        isArrayHeaderRequired = isArray;\n                        arrayItemsLeft = -1;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 13, 14, 19]);\n                        stream_2 = __asyncValues(stream);\n                        _b.label = 2;\n                    case 2: return [4 /*yield*/, __await(stream_2.next())];\n                    case 3:\n                        if (!(stream_2_1 = _b.sent(), !stream_2_1.done)) return [3 /*break*/, 12];\n                        buffer = stream_2_1.value;\n                        if (isArray && arrayItemsLeft === 0) {\n                            throw this.createExtraByteError(this.totalPos);\n                        }\n                        this.appendBuffer(buffer);\n                        if (isArrayHeaderRequired) {\n                            arrayItemsLeft = this.readArraySize();\n                            isArrayHeaderRequired = false;\n                            this.complete();\n                        }\n                        _b.label = 4;\n                    case 4:\n                        _b.trys.push([4, 9, , 10]);\n                        _b.label = 5;\n                    case 5:\n                        if (!true) return [3 /*break*/, 8];\n                        return [4 /*yield*/, __await(this.doDecodeSync())];\n                    case 6: return [4 /*yield*/, _b.sent()];\n                    case 7:\n                        _b.sent();\n                        if (--arrayItemsLeft === 0) {\n                            return [3 /*break*/, 8];\n                        }\n                        return [3 /*break*/, 5];\n                    case 8: return [3 /*break*/, 10];\n                    case 9:\n                        e_2 = _b.sent();\n                        if (!(e_2 instanceof DataViewIndexOutOfBoundsError)) {\n                            throw e_2; // rethrow\n                        }\n                        return [3 /*break*/, 10];\n                    case 10:\n                        this.totalPos += this.pos;\n                        _b.label = 11;\n                    case 11: return [3 /*break*/, 2];\n                    case 12: return [3 /*break*/, 19];\n                    case 13:\n                        e_3_1 = _b.sent();\n                        e_3 = { error: e_3_1 };\n                        return [3 /*break*/, 19];\n                    case 14:\n                        _b.trys.push([14, , 17, 18]);\n                        if (!(stream_2_1 && !stream_2_1.done && (_a = stream_2.return))) return [3 /*break*/, 16];\n                        return [4 /*yield*/, __await(_a.call(stream_2))];\n                    case 15:\n                        _b.sent();\n                        _b.label = 16;\n                    case 16: return [3 /*break*/, 18];\n                    case 17:\n                        if (e_3) throw e_3.error;\n                        return [7 /*endfinally*/];\n                    case 18: return [7 /*endfinally*/];\n                    case 19: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Decoder.prototype.doDecodeSync = function () {\n        DECODE: while (true) {\n            var headByte = this.readHeadByte();\n            var object = void 0;\n            if (headByte >= 0xe0) {\n                // negative fixint (111x xxxx) 0xe0 - 0xff\n                object = headByte - 0x100;\n            }\n            else if (headByte < 0xc0) {\n                if (headByte < 0x80) {\n                    // positive fixint (0xxx xxxx) 0x00 - 0x7f\n                    object = headByte;\n                }\n                else if (headByte < 0x90) {\n                    // fixmap (1000 xxxx) 0x80 - 0x8f\n                    var size = headByte - 0x80;\n                    if (size !== 0) {\n                        this.pushMapState(size);\n                        this.complete();\n                        continue DECODE;\n                    }\n                    else {\n                        object = {};\n                    }\n                }\n                else if (headByte < 0xa0) {\n                    // fixarray (1001 xxxx) 0x90 - 0x9f\n                    var size = headByte - 0x90;\n                    if (size !== 0) {\n                        this.pushArrayState(size);\n                        this.complete();\n                        continue DECODE;\n                    }\n                    else {\n                        object = [];\n                    }\n                }\n                else {\n                    // fixstr (101x xxxx) 0xa0 - 0xbf\n                    var byteLength = headByte - 0xa0;\n                    object = this.decodeUtf8String(byteLength, 0);\n                }\n            }\n            else if (headByte === 0xc0) {\n                // nil\n                object = null;\n            }\n            else if (headByte === 0xc2) {\n                // false\n                object = false;\n            }\n            else if (headByte === 0xc3) {\n                // true\n                object = true;\n            }\n            else if (headByte === 0xca) {\n                // float 32\n                object = this.readF32();\n            }\n            else if (headByte === 0xcb) {\n                // float 64\n                object = this.readF64();\n            }\n            else if (headByte === 0xcc) {\n                // uint 8\n                object = this.readU8();\n            }\n            else if (headByte === 0xcd) {\n                // uint 16\n                object = this.readU16();\n            }\n            else if (headByte === 0xce) {\n                // uint 32\n                object = this.readU32();\n            }\n            else if (headByte === 0xcf) {\n                // uint 64\n                object = this.readU64();\n            }\n            else if (headByte === 0xd0) {\n                // int 8\n                object = this.readI8();\n            }\n            else if (headByte === 0xd1) {\n                // int 16\n                object = this.readI16();\n            }\n            else if (headByte === 0xd2) {\n                // int 32\n                object = this.readI32();\n            }\n            else if (headByte === 0xd3) {\n                // int 64\n                object = this.readI64();\n            }\n            else if (headByte === 0xd9) {\n                // str 8\n                var byteLength = this.lookU8();\n                object = this.decodeUtf8String(byteLength, 1);\n            }\n            else if (headByte === 0xda) {\n                // str 16\n                var byteLength = this.lookU16();\n                object = this.decodeUtf8String(byteLength, 2);\n            }\n            else if (headByte === 0xdb) {\n                // str 32\n                var byteLength = this.lookU32();\n                object = this.decodeUtf8String(byteLength, 4);\n            }\n            else if (headByte === 0xdc) {\n                // array 16\n                var size = this.readU16();\n                if (size !== 0) {\n                    this.pushArrayState(size);\n                    this.complete();\n                    continue DECODE;\n                }\n                else {\n                    object = [];\n                }\n            }\n            else if (headByte === 0xdd) {\n                // array 32\n                var size = this.readU32();\n                if (size !== 0) {\n                    this.pushArrayState(size);\n                    this.complete();\n                    continue DECODE;\n                }\n                else {\n                    object = [];\n                }\n            }\n            else if (headByte === 0xde) {\n                // map 16\n                var size = this.readU16();\n                if (size !== 0) {\n                    this.pushMapState(size);\n                    this.complete();\n                    continue DECODE;\n                }\n                else {\n                    object = {};\n                }\n            }\n            else if (headByte === 0xdf) {\n                // map 32\n                var size = this.readU32();\n                if (size !== 0) {\n                    this.pushMapState(size);\n                    this.complete();\n                    continue DECODE;\n                }\n                else {\n                    object = {};\n                }\n            }\n            else if (headByte === 0xc4) {\n                // bin 8\n                var size = this.lookU8();\n                object = this.decodeBinary(size, 1);\n            }\n            else if (headByte === 0xc5) {\n                // bin 16\n                var size = this.lookU16();\n                object = this.decodeBinary(size, 2);\n            }\n            else if (headByte === 0xc6) {\n                // bin 32\n                var size = this.lookU32();\n                object = this.decodeBinary(size, 4);\n            }\n            else if (headByte === 0xd4) {\n                // fixext 1\n                object = this.decodeExtension(1, 0);\n            }\n            else if (headByte === 0xd5) {\n                // fixext 2\n                object = this.decodeExtension(2, 0);\n            }\n            else if (headByte === 0xd6) {\n                // fixext 4\n                object = this.decodeExtension(4, 0);\n            }\n            else if (headByte === 0xd7) {\n                // fixext 8\n                object = this.decodeExtension(8, 0);\n            }\n            else if (headByte === 0xd8) {\n                // fixext 16\n                object = this.decodeExtension(16, 0);\n            }\n            else if (headByte === 0xc7) {\n                // ext 8\n                var size = this.lookU8();\n                object = this.decodeExtension(size, 1);\n            }\n            else if (headByte === 0xc8) {\n                // ext 16\n                var size = this.lookU16();\n                object = this.decodeExtension(size, 2);\n            }\n            else if (headByte === 0xc9) {\n                // ext 32\n                var size = this.lookU32();\n                object = this.decodeExtension(size, 4);\n            }\n            else {\n                throw new DecodeError(\"Unrecognized type byte: \".concat(prettyByte(headByte)));\n            }\n            this.complete();\n            var stack = this.stack;\n            while (stack.length > 0) {\n                // arrays and maps\n                var state = stack[stack.length - 1];\n                if (state.type === 0 /* State.ARRAY */) {\n                    state.array[state.position] = object;\n                    state.position++;\n                    if (state.position === state.size) {\n                        stack.pop();\n                        object = state.array;\n                    }\n                    else {\n                        continue DECODE;\n                    }\n                }\n                else if (state.type === 1 /* State.MAP_KEY */) {\n                    if (!isValidMapKeyType(object)) {\n                        throw new DecodeError(\"The type of key must be string or number but \" + typeof object);\n                    }\n                    if (object === \"__proto__\") {\n                        throw new DecodeError(\"The key __proto__ is not allowed\");\n                    }\n                    state.key = object;\n                    state.type = 2 /* State.MAP_VALUE */;\n                    continue DECODE;\n                }\n                else {\n                    // it must be `state.type === State.MAP_VALUE` here\n                    state.map[state.key] = object;\n                    state.readCount++;\n                    if (state.readCount === state.size) {\n                        stack.pop();\n                        object = state.map;\n                    }\n                    else {\n                        state.key = null;\n                        state.type = 1 /* State.MAP_KEY */;\n                        continue DECODE;\n                    }\n                }\n            }\n            return object;\n        }\n    };\n    Decoder.prototype.readHeadByte = function () {\n        if (this.headByte === HEAD_BYTE_REQUIRED) {\n            this.headByte = this.readU8();\n            // console.log(\"headByte\", prettyByte(this.headByte));\n        }\n        return this.headByte;\n    };\n    Decoder.prototype.complete = function () {\n        this.headByte = HEAD_BYTE_REQUIRED;\n    };\n    Decoder.prototype.readArraySize = function () {\n        var headByte = this.readHeadByte();\n        switch (headByte) {\n            case 0xdc:\n                return this.readU16();\n            case 0xdd:\n                return this.readU32();\n            default: {\n                if (headByte < 0xa0) {\n                    return headByte - 0x90;\n                }\n                else {\n                    throw new DecodeError(\"Unrecognized array type byte: \".concat(prettyByte(headByte)));\n                }\n            }\n        }\n    };\n    Decoder.prototype.pushMapState = function (size) {\n        if (size > this.maxMapLength) {\n            throw new DecodeError(\"Max length exceeded: map length (\".concat(size, \") > maxMapLengthLength (\").concat(this.maxMapLength, \")\"));\n        }\n        this.stack.push({\n            type: 1 /* State.MAP_KEY */,\n            size: size,\n            key: null,\n            readCount: 0,\n            map: {},\n        });\n    };\n    Decoder.prototype.pushArrayState = function (size) {\n        if (size > this.maxArrayLength) {\n            throw new DecodeError(\"Max length exceeded: array length (\".concat(size, \") > maxArrayLength (\").concat(this.maxArrayLength, \")\"));\n        }\n        this.stack.push({\n            type: 0 /* State.ARRAY */,\n            size: size,\n            array: new Array(size),\n            position: 0,\n        });\n    };\n    Decoder.prototype.decodeUtf8String = function (byteLength, headerOffset) {\n        var _a;\n        if (byteLength > this.maxStrLength) {\n            throw new DecodeError(\"Max length exceeded: UTF-8 byte length (\".concat(byteLength, \") > maxStrLength (\").concat(this.maxStrLength, \")\"));\n        }\n        if (this.bytes.byteLength < this.pos + headerOffset + byteLength) {\n            throw MORE_DATA;\n        }\n        var offset = this.pos + headerOffset;\n        var object;\n        if (this.stateIsMapKey() && ((_a = this.keyDecoder) === null || _a === void 0 ? void 0 : _a.canBeCached(byteLength))) {\n            object = this.keyDecoder.decode(this.bytes, offset, byteLength);\n        }\n        else if (byteLength > TEXT_DECODER_THRESHOLD) {\n            object = utf8DecodeTD(this.bytes, offset, byteLength);\n        }\n        else {\n            object = utf8DecodeJs(this.bytes, offset, byteLength);\n        }\n        this.pos += headerOffset + byteLength;\n        return object;\n    };\n    Decoder.prototype.stateIsMapKey = function () {\n        if (this.stack.length > 0) {\n            var state = this.stack[this.stack.length - 1];\n            return state.type === 1 /* State.MAP_KEY */;\n        }\n        return false;\n    };\n    Decoder.prototype.decodeBinary = function (byteLength, headOffset) {\n        if (byteLength > this.maxBinLength) {\n            throw new DecodeError(\"Max length exceeded: bin length (\".concat(byteLength, \") > maxBinLength (\").concat(this.maxBinLength, \")\"));\n        }\n        if (!this.hasRemaining(byteLength + headOffset)) {\n            throw MORE_DATA;\n        }\n        var offset = this.pos + headOffset;\n        var object = this.bytes.subarray(offset, offset + byteLength);\n        this.pos += headOffset + byteLength;\n        return object;\n    };\n    Decoder.prototype.decodeExtension = function (size, headOffset) {\n        if (size > this.maxExtLength) {\n            throw new DecodeError(\"Max length exceeded: ext length (\".concat(size, \") > maxExtLength (\").concat(this.maxExtLength, \")\"));\n        }\n        var extType = this.view.getInt8(this.pos + headOffset);\n        var data = this.decodeBinary(size, headOffset + 1 /* extType */);\n        return this.extensionCodec.decode(data, extType, this.context);\n    };\n    Decoder.prototype.lookU8 = function () {\n        return this.view.getUint8(this.pos);\n    };\n    Decoder.prototype.lookU16 = function () {\n        return this.view.getUint16(this.pos);\n    };\n    Decoder.prototype.lookU32 = function () {\n        return this.view.getUint32(this.pos);\n    };\n    Decoder.prototype.readU8 = function () {\n        var value = this.view.getUint8(this.pos);\n        this.pos++;\n        return value;\n    };\n    Decoder.prototype.readI8 = function () {\n        var value = this.view.getInt8(this.pos);\n        this.pos++;\n        return value;\n    };\n    Decoder.prototype.readU16 = function () {\n        var value = this.view.getUint16(this.pos);\n        this.pos += 2;\n        return value;\n    };\n    Decoder.prototype.readI16 = function () {\n        var value = this.view.getInt16(this.pos);\n        this.pos += 2;\n        return value;\n    };\n    Decoder.prototype.readU32 = function () {\n        var value = this.view.getUint32(this.pos);\n        this.pos += 4;\n        return value;\n    };\n    Decoder.prototype.readI32 = function () {\n        var value = this.view.getInt32(this.pos);\n        this.pos += 4;\n        return value;\n    };\n    Decoder.prototype.readU64 = function () {\n        var value = getUint64(this.view, this.pos);\n        this.pos += 8;\n        return value;\n    };\n    Decoder.prototype.readI64 = function () {\n        var value = getInt64(this.view, this.pos);\n        this.pos += 8;\n        return value;\n    };\n    Decoder.prototype.readF32 = function () {\n        var value = this.view.getFloat32(this.pos);\n        this.pos += 4;\n        return value;\n    };\n    Decoder.prototype.readF64 = function () {\n        var value = this.view.getFloat64(this.pos);\n        this.pos += 8;\n        return value;\n    };\n    return Decoder;\n}());\nexport { Decoder };\n//# sourceMappingURL=Decoder.mjs.map","import { utf8EncodeJs, utf8Count, TEXT_ENCODER_THRESHOLD, utf8EncodeTE } from \"./utils/utf8.mjs\";\nimport { ExtensionCodec } from \"./ExtensionCodec.mjs\";\nimport { setInt64, setUint64 } from \"./utils/int.mjs\";\nimport { ensureUint8Array } from \"./utils/typedArrays.mjs\";\nexport var DEFAULT_MAX_DEPTH = 100;\nexport var DEFAULT_INITIAL_BUFFER_SIZE = 2048;\nvar Encoder = /** @class */ (function () {\n    function Encoder(extensionCodec, context, maxDepth, initialBufferSize, sortKeys, forceFloat32, ignoreUndefined, forceIntegerToFloat) {\n        if (extensionCodec === void 0) { extensionCodec = ExtensionCodec.defaultCodec; }\n        if (context === void 0) { context = undefined; }\n        if (maxDepth === void 0) { maxDepth = DEFAULT_MAX_DEPTH; }\n        if (initialBufferSize === void 0) { initialBufferSize = DEFAULT_INITIAL_BUFFER_SIZE; }\n        if (sortKeys === void 0) { sortKeys = false; }\n        if (forceFloat32 === void 0) { forceFloat32 = false; }\n        if (ignoreUndefined === void 0) { ignoreUndefined = false; }\n        if (forceIntegerToFloat === void 0) { forceIntegerToFloat = false; }\n        this.extensionCodec = extensionCodec;\n        this.context = context;\n        this.maxDepth = maxDepth;\n        this.initialBufferSize = initialBufferSize;\n        this.sortKeys = sortKeys;\n        this.forceFloat32 = forceFloat32;\n        this.ignoreUndefined = ignoreUndefined;\n        this.forceIntegerToFloat = forceIntegerToFloat;\n        this.pos = 0;\n        this.view = new DataView(new ArrayBuffer(this.initialBufferSize));\n        this.bytes = new Uint8Array(this.view.buffer);\n    }\n    Encoder.prototype.reinitializeState = function () {\n        this.pos = 0;\n    };\n    /**\n     * This is almost equivalent to {@link Encoder#encode}, but it returns an reference of the encoder's internal buffer and thus much faster than {@link Encoder#encode}.\n     *\n     * @returns Encodes the object and returns a shared reference the encoder's internal buffer.\n     */\n    Encoder.prototype.encodeSharedRef = function (object) {\n        this.reinitializeState();\n        this.doEncode(object, 1);\n        return this.bytes.subarray(0, this.pos);\n    };\n    /**\n     * @returns Encodes the object and returns a copy of the encoder's internal buffer.\n     */\n    Encoder.prototype.encode = function (object) {\n        this.reinitializeState();\n        this.doEncode(object, 1);\n        return this.bytes.slice(0, this.pos);\n    };\n    Encoder.prototype.doEncode = function (object, depth) {\n        if (depth > this.maxDepth) {\n            throw new Error(\"Too deep objects in depth \".concat(depth));\n        }\n        if (object == null) {\n            this.encodeNil();\n        }\n        else if (typeof object === \"boolean\") {\n            this.encodeBoolean(object);\n        }\n        else if (typeof object === \"number\") {\n            this.encodeNumber(object);\n        }\n        else if (typeof object === \"string\") {\n            this.encodeString(object);\n        }\n        else {\n            this.encodeObject(object, depth);\n        }\n    };\n    Encoder.prototype.ensureBufferSizeToWrite = function (sizeToWrite) {\n        var requiredSize = this.pos + sizeToWrite;\n        if (this.view.byteLength < requiredSize) {\n            this.resizeBuffer(requiredSize * 2);\n        }\n    };\n    Encoder.prototype.resizeBuffer = function (newSize) {\n        var newBuffer = new ArrayBuffer(newSize);\n        var newBytes = new Uint8Array(newBuffer);\n        var newView = new DataView(newBuffer);\n        newBytes.set(this.bytes);\n        this.view = newView;\n        this.bytes = newBytes;\n    };\n    Encoder.prototype.encodeNil = function () {\n        this.writeU8(0xc0);\n    };\n    Encoder.prototype.encodeBoolean = function (object) {\n        if (object === false) {\n            this.writeU8(0xc2);\n        }\n        else {\n            this.writeU8(0xc3);\n        }\n    };\n    Encoder.prototype.encodeNumber = function (object) {\n        if (Number.isSafeInteger(object) && !this.forceIntegerToFloat) {\n            if (object >= 0) {\n                if (object < 0x80) {\n                    // positive fixint\n                    this.writeU8(object);\n                }\n                else if (object < 0x100) {\n                    // uint 8\n                    this.writeU8(0xcc);\n                    this.writeU8(object);\n                }\n                else if (object < 0x10000) {\n                    // uint 16\n                    this.writeU8(0xcd);\n                    this.writeU16(object);\n                }\n                else if (object < 0x100000000) {\n                    // uint 32\n                    this.writeU8(0xce);\n                    this.writeU32(object);\n                }\n                else {\n                    // uint 64\n                    this.writeU8(0xcf);\n                    this.writeU64(object);\n                }\n            }\n            else {\n                if (object >= -0x20) {\n                    // negative fixint\n                    this.writeU8(0xe0 | (object + 0x20));\n                }\n                else if (object >= -0x80) {\n                    // int 8\n                    this.writeU8(0xd0);\n                    this.writeI8(object);\n                }\n                else if (object >= -0x8000) {\n                    // int 16\n                    this.writeU8(0xd1);\n                    this.writeI16(object);\n                }\n                else if (object >= -0x80000000) {\n                    // int 32\n                    this.writeU8(0xd2);\n                    this.writeI32(object);\n                }\n                else {\n                    // int 64\n                    this.writeU8(0xd3);\n                    this.writeI64(object);\n                }\n            }\n        }\n        else {\n            // non-integer numbers\n            if (this.forceFloat32) {\n                // float 32\n                this.writeU8(0xca);\n                this.writeF32(object);\n            }\n            else {\n                // float 64\n                this.writeU8(0xcb);\n                this.writeF64(object);\n            }\n        }\n    };\n    Encoder.prototype.writeStringHeader = function (byteLength) {\n        if (byteLength < 32) {\n            // fixstr\n            this.writeU8(0xa0 + byteLength);\n        }\n        else if (byteLength < 0x100) {\n            // str 8\n            this.writeU8(0xd9);\n            this.writeU8(byteLength);\n        }\n        else if (byteLength < 0x10000) {\n            // str 16\n            this.writeU8(0xda);\n            this.writeU16(byteLength);\n        }\n        else if (byteLength < 0x100000000) {\n            // str 32\n            this.writeU8(0xdb);\n            this.writeU32(byteLength);\n        }\n        else {\n            throw new Error(\"Too long string: \".concat(byteLength, \" bytes in UTF-8\"));\n        }\n    };\n    Encoder.prototype.encodeString = function (object) {\n        var maxHeaderSize = 1 + 4;\n        var strLength = object.length;\n        if (strLength > TEXT_ENCODER_THRESHOLD) {\n            var byteLength = utf8Count(object);\n            this.ensureBufferSizeToWrite(maxHeaderSize + byteLength);\n            this.writeStringHeader(byteLength);\n            utf8EncodeTE(object, this.bytes, this.pos);\n            this.pos += byteLength;\n        }\n        else {\n            var byteLength = utf8Count(object);\n            this.ensureBufferSizeToWrite(maxHeaderSize + byteLength);\n            this.writeStringHeader(byteLength);\n            utf8EncodeJs(object, this.bytes, this.pos);\n            this.pos += byteLength;\n        }\n    };\n    Encoder.prototype.encodeObject = function (object, depth) {\n        // try to encode objects with custom codec first of non-primitives\n        var ext = this.extensionCodec.tryToEncode(object, this.context);\n        if (ext != null) {\n            this.encodeExtension(ext);\n        }\n        else if (Array.isArray(object)) {\n            this.encodeArray(object, depth);\n        }\n        else if (ArrayBuffer.isView(object)) {\n            this.encodeBinary(object);\n        }\n        else if (typeof object === \"object\") {\n            this.encodeMap(object, depth);\n        }\n        else {\n            // symbol, function and other special object come here unless extensionCodec handles them.\n            throw new Error(\"Unrecognized object: \".concat(Object.prototype.toString.apply(object)));\n        }\n    };\n    Encoder.prototype.encodeBinary = function (object) {\n        var size = object.byteLength;\n        if (size < 0x100) {\n            // bin 8\n            this.writeU8(0xc4);\n            this.writeU8(size);\n        }\n        else if (size < 0x10000) {\n            // bin 16\n            this.writeU8(0xc5);\n            this.writeU16(size);\n        }\n        else if (size < 0x100000000) {\n            // bin 32\n            this.writeU8(0xc6);\n            this.writeU32(size);\n        }\n        else {\n            throw new Error(\"Too large binary: \".concat(size));\n        }\n        var bytes = ensureUint8Array(object);\n        this.writeU8a(bytes);\n    };\n    Encoder.prototype.encodeArray = function (object, depth) {\n        var size = object.length;\n        if (size < 16) {\n            // fixarray\n            this.writeU8(0x90 + size);\n        }\n        else if (size < 0x10000) {\n            // array 16\n            this.writeU8(0xdc);\n            this.writeU16(size);\n        }\n        else if (size < 0x100000000) {\n            // array 32\n            this.writeU8(0xdd);\n            this.writeU32(size);\n        }\n        else {\n            throw new Error(\"Too large array: \".concat(size));\n        }\n        for (var _i = 0, object_1 = object; _i < object_1.length; _i++) {\n            var item = object_1[_i];\n            this.doEncode(item, depth + 1);\n        }\n    };\n    Encoder.prototype.countWithoutUndefined = function (object, keys) {\n        var count = 0;\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var key = keys_1[_i];\n            if (object[key] !== undefined) {\n                count++;\n            }\n        }\n        return count;\n    };\n    Encoder.prototype.encodeMap = function (object, depth) {\n        var keys = Object.keys(object);\n        if (this.sortKeys) {\n            keys.sort();\n        }\n        var size = this.ignoreUndefined ? this.countWithoutUndefined(object, keys) : keys.length;\n        if (size < 16) {\n            // fixmap\n            this.writeU8(0x80 + size);\n        }\n        else if (size < 0x10000) {\n            // map 16\n            this.writeU8(0xde);\n            this.writeU16(size);\n        }\n        else if (size < 0x100000000) {\n            // map 32\n            this.writeU8(0xdf);\n            this.writeU32(size);\n        }\n        else {\n            throw new Error(\"Too large map object: \".concat(size));\n        }\n        for (var _i = 0, keys_2 = keys; _i < keys_2.length; _i++) {\n            var key = keys_2[_i];\n            var value = object[key];\n            if (!(this.ignoreUndefined && value === undefined)) {\n                this.encodeString(key);\n                this.doEncode(value, depth + 1);\n            }\n        }\n    };\n    Encoder.prototype.encodeExtension = function (ext) {\n        var size = ext.data.length;\n        if (size === 1) {\n            // fixext 1\n            this.writeU8(0xd4);\n        }\n        else if (size === 2) {\n            // fixext 2\n            this.writeU8(0xd5);\n        }\n        else if (size === 4) {\n            // fixext 4\n            this.writeU8(0xd6);\n        }\n        else if (size === 8) {\n            // fixext 8\n            this.writeU8(0xd7);\n        }\n        else if (size === 16) {\n            // fixext 16\n            this.writeU8(0xd8);\n        }\n        else if (size < 0x100) {\n            // ext 8\n            this.writeU8(0xc7);\n            this.writeU8(size);\n        }\n        else if (size < 0x10000) {\n            // ext 16\n            this.writeU8(0xc8);\n            this.writeU16(size);\n        }\n        else if (size < 0x100000000) {\n            // ext 32\n            this.writeU8(0xc9);\n            this.writeU32(size);\n        }\n        else {\n            throw new Error(\"Too large extension object: \".concat(size));\n        }\n        this.writeI8(ext.type);\n        this.writeU8a(ext.data);\n    };\n    Encoder.prototype.writeU8 = function (value) {\n        this.ensureBufferSizeToWrite(1);\n        this.view.setUint8(this.pos, value);\n        this.pos++;\n    };\n    Encoder.prototype.writeU8a = function (values) {\n        var size = values.length;\n        this.ensureBufferSizeToWrite(size);\n        this.bytes.set(values, this.pos);\n        this.pos += size;\n    };\n    Encoder.prototype.writeI8 = function (value) {\n        this.ensureBufferSizeToWrite(1);\n        this.view.setInt8(this.pos, value);\n        this.pos++;\n    };\n    Encoder.prototype.writeU16 = function (value) {\n        this.ensureBufferSizeToWrite(2);\n        this.view.setUint16(this.pos, value);\n        this.pos += 2;\n    };\n    Encoder.prototype.writeI16 = function (value) {\n        this.ensureBufferSizeToWrite(2);\n        this.view.setInt16(this.pos, value);\n        this.pos += 2;\n    };\n    Encoder.prototype.writeU32 = function (value) {\n        this.ensureBufferSizeToWrite(4);\n        this.view.setUint32(this.pos, value);\n        this.pos += 4;\n    };\n    Encoder.prototype.writeI32 = function (value) {\n        this.ensureBufferSizeToWrite(4);\n        this.view.setInt32(this.pos, value);\n        this.pos += 4;\n    };\n    Encoder.prototype.writeF32 = function (value) {\n        this.ensureBufferSizeToWrite(4);\n        this.view.setFloat32(this.pos, value);\n        this.pos += 4;\n    };\n    Encoder.prototype.writeF64 = function (value) {\n        this.ensureBufferSizeToWrite(8);\n        this.view.setFloat64(this.pos, value);\n        this.pos += 8;\n    };\n    Encoder.prototype.writeU64 = function (value) {\n        this.ensureBufferSizeToWrite(8);\n        setUint64(this.view, this.pos, value);\n        this.pos += 8;\n    };\n    Encoder.prototype.writeI64 = function (value) {\n        this.ensureBufferSizeToWrite(8);\n        setInt64(this.view, this.pos, value);\n        this.pos += 8;\n    };\n    return Encoder;\n}());\nexport { Encoder };\n//# sourceMappingURL=Encoder.mjs.map","// Helper borrowed from paraviewweb/src/Common/Core\nimport CompositeClosureHelper from '../CompositeClosureHelper';\nimport { UnChunker, generateChunks } from './chunking';\nimport { Encoder, Decoder } from '@msgpack/msgpack';\n\nfunction defer() {\n  const deferred = {};\n\n  deferred.promise = new Promise(function (resolve, reject) {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n\n  return deferred;\n}\n\nfunction Session(publicAPI, model) {\n  const CLIENT_ERROR = -32099;\n  let msgCount = 0;\n  const inFlightRpc = {};\n  // matches 'rpc:client3:21'\n  // client may be dot-separated and include '_'\n  // number is message count - unique.\n  // matches 'publish:dot.separated.topic:42'\n  const regexRPC = /^(rpc|publish|system):(\\w+(?:\\.\\w+)*):(?:\\d+)$/;\n  const subscriptions = {};\n  let clientID = null;\n  let MAX_MSG_SIZE = 512 * 1024;\n  const unchunker = new UnChunker();\n\n  // --------------------------------------------------------------------------\n  // Private helpers\n  // --------------------------------------------------------------------------\n\n  function onCompleteMessage(payload) {\n    if (!payload) return;\n    if (!payload.id) return;\n    if (payload.error) {\n      const deferred = inFlightRpc[payload.id];\n      if (deferred) {\n        deferred.reject(payload.error);\n      } else {\n        console.error('Server error:', payload.error);\n      }\n    } else {\n      const match = regexRPC.exec(payload.id);\n      if (match) {\n        const type = match[1];\n        if (type === 'rpc') {\n          const deferred = inFlightRpc[payload.id];\n          if (!deferred) {\n            console.log(\n              'session message id without matching call, dropped',\n              payload\n            );\n            return;\n          }\n          deferred.resolve(payload.result);\n        } else if (type == 'publish') {\n          console.assert(\n            inFlightRpc[payload.id] === undefined,\n            'publish message received matching in-flight rpc call'\n          );\n          // regex extracts the topic for us.\n          const topic = match[2];\n          if (!subscriptions[topic]) {\n            return;\n          }\n          // for each callback, provide the message data. Wrap in an array, for back-compatibility with WAMP\n          subscriptions[topic].forEach((callback) =>\n            callback([payload.result])\n          );\n        } else if (type == 'system') {\n          // console.log('DBG system:', payload.id, payload.result);\n          const deferred = inFlightRpc[payload.id];\n          if (payload.id === 'system:c0:0') {\n            clientID = payload.result.clientID;\n            MAX_MSG_SIZE = payload.result.maxMsgSize || MAX_MSG_SIZE;\n            if (deferred) deferred.resolve(clientID);\n          } else {\n            console.error('Unknown system message', payload.id);\n            if (deferred)\n              deferred.reject({\n                code: CLIENT_ERROR,\n                message: `Unknown system message ${payload.id}`,\n              });\n          }\n        } else {\n          console.error('Unknown rpc id format', payload.id);\n        }\n      }\n    }\n    delete inFlightRpc[payload.id];\n  }\n\n  // --------------------------------------------------------------------------\n  // Public API\n  // --------------------------------------------------------------------------\n\n  publicAPI.onconnect = (event) => {\n    // send hello message\n    const deferred = defer();\n    const id = 'system:c0:0';\n    inFlightRpc[id] = deferred;\n\n    const wrapper = {\n      wslink: '1.0',\n      id,\n      method: 'wslink.hello',\n      args: [{ secret: model.secret }],\n      kwargs: {},\n    };\n\n    const encoder = new CustomEncoder();\n    const packedWrapper = encoder.encode(wrapper);\n\n    for (let chunk of generateChunks(packedWrapper, MAX_MSG_SIZE)) {\n      model.ws.send(chunk, { binary: true });\n    }\n\n    return deferred.promise;\n  };\n\n  // --------------------------------------------------------------------------\n\n  publicAPI.call = (method, args = [], kwargs = {}) => {\n    // create a promise that we will use to notify the caller of the result.\n    const deferred = defer();\n    // readyState OPEN === 1\n    if (model.ws && clientID && model.ws.readyState === 1) {\n      const id = `rpc:${clientID}:${msgCount++}`;\n      inFlightRpc[id] = deferred;\n\n      const wrapper = { wslink: '1.0', id, method, args, kwargs };\n\n      const encoder = new CustomEncoder();\n      const packedWrapper = encoder.encode(wrapper);\n\n      for (let chunk of generateChunks(packedWrapper, MAX_MSG_SIZE)) {\n        model.ws.send(chunk, { binary: true });\n      }\n    } else {\n      deferred.reject({\n        code: CLIENT_ERROR,\n        message: `RPC call ${method} unsuccessful: connection not open`,\n      });\n    }\n    return deferred.promise;\n  };\n\n  // --------------------------------------------------------------------------\n\n  publicAPI.subscribe = (topic, callback) => {\n    const deferred = defer();\n    if (model.ws && clientID) {\n      // we needs to track subscriptions, to trigger callback when publish is received.\n      if (!subscriptions[topic]) subscriptions[topic] = [];\n      subscriptions[topic].push(callback);\n      // we can notify the server, but we don't need to, if the server always sends messages unconditionally.\n      // model.ws.send(JSON.stringify({ wslink: '1.0', id: `subscribe:${msgCount++}`, method, args: [] }));\n      deferred.resolve({ topic, callback });\n    } else {\n      deferred.reject({\n        code: CLIENT_ERROR,\n        message: `Subscribe call ${topic} unsuccessful: connection not open`,\n      });\n    }\n    return {\n      topic,\n      callback,\n      promise: deferred.promise,\n      unsubscribe: () => publicAPI.unsubscribe({ topic, callback }),\n    };\n  };\n\n  // --------------------------------------------------------------------------\n\n  publicAPI.unsubscribe = (info) => {\n    const deferred = defer();\n    const { topic, callback } = info;\n    if (!subscriptions[topic]) {\n      deferred.reject({\n        code: CLIENT_ERROR,\n        message: `Unsubscribe call ${topic} unsuccessful: not subscribed`,\n      });\n      return deferred.promise;\n    }\n    const index = subscriptions[topic].indexOf(callback);\n    if (index !== -1) {\n      subscriptions[topic].splice(index, 1);\n      deferred.resolve();\n    } else {\n      deferred.reject({\n        code: CLIENT_ERROR,\n        message: `Unsubscribe call ${topic} unsuccessful: callback not found`,\n      });\n    }\n    return deferred.promise;\n  };\n\n  // --------------------------------------------------------------------------\n\n  publicAPI.close = () => {\n    const deferred = defer();\n    // some transports might be able to close the session without closing the connection. Not true for websocket...\n    model.ws.close();\n    unchunker.releasePendingMessages();\n    deferred.resolve();\n    return deferred.promise;\n  };\n\n  // --------------------------------------------------------------------------\n\n  function createDecoder() {\n    return new Decoder();\n  }\n\n  publicAPI.onmessage = async (event) => {\n    const message = await unchunker.processChunk(event.data, createDecoder);\n\n    if (message) {\n      onCompleteMessage(message);\n    }\n  };\n\n  // --------------------------------------------------------------------------\n\n  publicAPI.addAttachment = (payload) => {\n    // Deprecated method, keeping it to avoid breaking compatibility\n    // Now that we use msgpack to pack/unpack messages,\n    // We can have binary data directly in the object itself,\n    // without needing to transfer it separately from the rest.\n    //\n    // If an ArrayBuffer is passed, ensure it gets wrapped in\n    // a DataView (which is what the encoder expects).\n    if (payload instanceof ArrayBuffer) {\n      return new DataView(payload);\n    }\n\n    return payload;\n  };\n}\n\nconst DEFAULT_VALUES = {\n  secret: 'wslink-secret',\n  ws: null,\n};\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  CompositeClosureHelper.destroy(publicAPI, model);\n  CompositeClosureHelper.isA(publicAPI, model, 'Session');\n\n  Session(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = CompositeClosureHelper.newInstance(extend);\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n\nclass CustomEncoder extends Encoder {\n  // Unfortunately @msgpack/msgpack only supports\n  // views of an ArrayBuffer (DataView, Uint8Array,..),\n  // but not an ArrayBuffer itself.\n  // They suggest using custom type extensions to support it,\n  // but that would yield a different packed payload\n  // (1 byte larger, but most importantly it would require\n  // dealing with the custom type when unpacking on the server).\n  // Since this type is too trivial to be treated differently,\n  // and since I don't want to rely on the users always wrapping\n  // their ArrayBuffers in a view, I'm subclassing the encoder.\n  encodeObject(object, depth) {\n    if (object instanceof ArrayBuffer) {\n      object = new DataView(object);\n    }\n\n    return super.encodeObject.call(this, object, depth);\n  }\n}\n","// Helper borrowed from paraviewweb/src/Common/Core\nimport CompositeClosureHelper from '../CompositeClosureHelper';\nimport Session from './session';\n\nconst DEFAULT_SECRET = 'wslink-secret';\n\nfunction getTransportObject(url) {\n  var idx = url.indexOf(':'),\n    protocol = url.substring(0, idx);\n  if (protocol === 'ws' || protocol === 'wss') {\n    return {\n      type: 'websocket',\n      url,\n    };\n  }\n\n  throw new Error(\n    `Unknown protocol (${protocol}) for url (${url}).  Unable to create transport object.`\n  );\n}\n\nfunction WebsocketConnection(publicAPI, model) {\n  // TODO Should we try to reconnect on error?\n\n  publicAPI.connect = () => {\n    // without a URL we can't do anything.\n    if (!model.urls) return null;\n    // concat allows a single url or a list.\n    var uriList = [].concat(model.urls),\n      transports = [];\n\n    for (let i = 0; i < uriList.length; i += 1) {\n      const url = uriList[i];\n      try {\n        const transport = getTransportObject(url);\n        transports.push(transport);\n      } catch (transportCreateError) {\n        console.error(transportCreateError);\n        publicAPI.fireConnectionError(publicAPI, transportCreateError);\n        return null;\n      }\n    }\n\n    if (model.connection) {\n      if (model.connection.url !== transports[0].url) {\n        model.connection.close();\n      } else if (\n        model.connection.readyState === 0 ||\n        model.connection.readyState === 1\n      ) {\n        // already connected.\n        return model.session;\n      }\n    }\n    try {\n      if (model.wsProxy) {\n        model.connection = WSLINK.createWebSocket(transports[0].url);\n      } else {\n        model.connection = new WebSocket(transports[0].url);\n      }\n    } catch (err) {\n      // If the server isn't running, we still don't enter here on Chrome -\n      // console shows a net::ERR_CONNECTION_REFUSED error inside WebSocket\n      console.error(err);\n      publicAPI.fireConnectionError(publicAPI, err);\n      return null;\n    }\n\n    model.connection.binaryType = 'blob';\n    if (!model.secret) model.secret = DEFAULT_SECRET;\n    model.session = Session.newInstance({\n      ws: model.connection,\n      secret: model.secret,\n    });\n\n    model.connection.onopen = (event) => {\n      if (model.session) {\n        // sends handshake message - wait for reply before issuing ready()\n        model.session.onconnect(event).then(\n          () => {\n            publicAPI.fireConnectionReady(publicAPI);\n          },\n          (err) => {\n            console.error('Connection error', err);\n            publicAPI.fireConnectionError(publicAPI, err);\n          }\n        );\n      }\n    };\n\n    model.connection.onclose = (event) => {\n      publicAPI.fireConnectionClose(publicAPI, event);\n      model.connection = null;\n      // return !model.retry; // true => Stop retry\n    };\n    model.connection.onerror = (event) => {\n      publicAPI.fireConnectionError(publicAPI, event);\n    };\n    // handle messages in the session.\n    model.connection.onmessage = (event) => {\n      model.session.onmessage(event);\n    };\n    return model.session;\n  };\n\n  publicAPI.getSession = () => model.session;\n\n  publicAPI.getUrl = () =>\n    model.connection ? model.connection.url : undefined;\n\n  function cleanUp(timeout = 10) {\n    if (\n      model.connection &&\n      model.connection.readyState === 1 &&\n      model.session &&\n      timeout > 0\n    ) {\n      model.session.call('application.exit.later', [timeout]);\n    }\n    if (model.connection) {\n      model.connection.close();\n    }\n    model.connection = null;\n  }\n\n  publicAPI.destroy = CompositeClosureHelper.chain(cleanUp, publicAPI.destroy);\n}\n\nconst DEFAULT_VALUES = {\n  secret: DEFAULT_SECRET,\n  connection: null,\n  session: null,\n  retry: false,\n  wsProxy: false, // Use WSLINK.WebSocket if true else native WebSocket\n};\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  CompositeClosureHelper.destroy(publicAPI, model);\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionReady');\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionClose');\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionError');\n  CompositeClosureHelper.isA(publicAPI, model, 'WebsocketConnection');\n\n  WebsocketConnection(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = CompositeClosureHelper.newInstance(extend);\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","/* global window */\nimport CompositeClosureHelper from '../CompositeClosureHelper';\n\nimport ProcessLauncher from '../ProcessLauncher';\nimport WebsocketConnection from '../WebsocketConnection';\n\nfunction DEFAULT_CONFIG_DECORATOR(config) {\n  if (config.sessionURL) {\n    config.sessionURL = config.sessionURL.replaceAll(\n      'USE_HOSTNAME',\n      window.location.hostname\n    );\n    config.sessionURL = config.sessionURL.replaceAll(\n      'USE_HOST',\n      window.location.host\n    );\n  }\n  return config;\n}\n\nfunction extractPathName(addOn, pathName = window.location.pathname) {\n  if (pathName.endsWith('.html') || pathName.endsWith('.htm')) {\n    const tokens = pathName.split('/');\n    tokens.pop();\n    pathName = tokens.join('/');\n  }\n  while (pathName.length > 0 && pathName[pathName.length - 1] === '/') {\n    pathName = pathName.substring(0, pathName.length - 1);\n  }\n  if (pathName.length === 0) {\n    return addOn;\n  }\n  return `${pathName}${addOn}`;\n}\n\nexport const DEFAULT_SESSION_MANAGER_URL = `${document.baseURI}paraview/`;\n\nexport const DEFAULT_SESSION_URL = `${\n  window.location.protocol === 'https:' ? 'wss:' : 'ws:'\n}//${window.location.hostname}:${window.location.port}${extractPathName(\n  '/ws'\n)}`;\n\nfunction wsConnect(publicAPI, model) {\n  const wsConnection = WebsocketConnection.newInstance({\n    urls: model.config.sessionURL,\n    secret: model.config.secret,\n    retry: model.config.retry,\n    wsProxy: model.config.iframe || model.config.wsProxy,\n  });\n  model.subscriptions.push(\n    wsConnection.onConnectionReady(publicAPI.readyForwarder)\n  );\n  model.subscriptions.push(\n    wsConnection.onConnectionError(publicAPI.errorForwarder)\n  );\n  model.subscriptions.push(\n    wsConnection.onConnectionClose(publicAPI.closeForwarder)\n  );\n\n  // Add to the garbage collector\n  model.gc.push(wsConnection);\n\n  return wsConnection.connect();\n}\n\nfunction smartConnect(publicAPI, model) {\n  let session = null;\n  model.gc = [];\n\n  // Event forwarders\n  publicAPI.readyForwarder = (data) => {\n    session = data.getSession();\n    publicAPI.fireConnectionReady(data);\n  };\n  publicAPI.errorForwarder = (data, err) => {\n    publicAPI.fireConnectionError(data, err);\n  };\n  publicAPI.closeForwarder = (data, err) => {\n    publicAPI.fireConnectionClose(data, err);\n  };\n\n  publicAPI.connect = () => {\n    if (model.configDecorator) {\n      model.config = model.configDecorator(model.config);\n    }\n    model.config = DEFAULT_CONFIG_DECORATOR(model.config);\n\n    if (model.config.sessionURL) {\n      // We have a direct connection URL\n      session = wsConnect(publicAPI, model);\n    } else if (model.config.wsProxy) {\n      // Provide fake url if missing since we rely on a proxy\n      model.config.sessionURL = model.config.sessionURL || \"wss://proxy/\";\n      session = wsConnect(publicAPI, model);\n    } else {\n      // We need to use the Launcher\n      const launcher = ProcessLauncher.newInstance({\n        endPoint: model.config.sessionManagerURL || DEFAULT_SESSION_MANAGER_URL,\n      });\n\n      model.subscriptions.push(\n        launcher.onProcessReady((data) => {\n          if (model.configDecorator) {\n            model.config = model.configDecorator(\n              Object.assign({}, model.config, data)\n            );\n          } else {\n            model.config = Object.assign({}, model.config, data);\n          }\n          model.config = DEFAULT_CONFIG_DECORATOR(model.config);\n\n          session = wsConnect(publicAPI, model);\n        })\n      );\n      model.subscriptions.push(\n        launcher.onError((data) => {\n          if (data && data.response && data.response.error) {\n            publicAPI.errorForwarder(data, data.response.error);\n          } else {\n            // Try to use standard connection URL\n            model.config.sessionURL = DEFAULT_SESSION_URL;\n            model.config = DEFAULT_CONFIG_DECORATOR(model.config);\n            session = wsConnect(publicAPI, model);\n          }\n        })\n      );\n\n      launcher.start(model.config);\n\n      // Add to the garbage collector\n      model.gc.push(launcher);\n    }\n  };\n\n  publicAPI.getSession = () => {\n    return session;\n  };\n\n  function cleanUp(timeout) {\n    if (session) {\n      if (timeout > 0) {\n        session.call('application.exit.later', [timeout]);\n      }\n      session.close();\n    }\n    session = null;\n\n    while (model.gc.length) {\n      model.gc.pop().destroy();\n    }\n  }\n\n  publicAPI.destroy = CompositeClosureHelper.chain(cleanUp, publicAPI.destroy);\n}\n\nconst DEFAULT_VALUES = {\n  config: {},\n  // configDecorator: null,\n};\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  CompositeClosureHelper.destroy(publicAPI, model);\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionReady');\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionClose');\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionError');\n  CompositeClosureHelper.isA(publicAPI, model, 'SmartConnect');\n  CompositeClosureHelper.get(publicAPI, model, ['config', 'configDecorator']);\n  CompositeClosureHelper.set(publicAPI, model, ['configDecorator']);\n\n  smartConnect(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\nexport const newInstance = CompositeClosureHelper.newInstance(extend);\n\nexport default { newInstance, extend };\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","capitalize","str","charAt","toUpperCase","slice","chain","fn","args","filter","i","forEach","destroy","publicAPI","model","previousDestroy","subscriptions","length","pop","unsubscribe","keys","field","deleted","event","eventName","asynchrounous","callbacks","off","index","processCallbacks","callback","apply","errObj","console","log","setTimeout","push","freeze","on","el","name","isA","className","indexOf","newInstance","extend","set","connections","DEFAULT_VALUES","endPoint","initialValues","assign","CompositeClosureHelper","start","config","xhr","XMLHttpRequest","url","_retry","launcherRetry","open","headers","_headers","entries","setRequestHeader","responseType","supportsJson","onload","e","response","JSON","parse","status","error","fireProcessReady","timeout","shift","fireError","onerror","send","stringify","fetchConnection","sessionId","join","fireFetch","stop","connection","id","fireProcessStopped","listConnections","ProcessLauncher","generateChunks","ID_LOCATION","MESSAGE_OFFSET_LOCATION","MESSAGE_SIZE_LOCATION","HEADER_LENGTH","ID_LENGTH","encodeHeader","offset","size","buffer","ArrayBuffer","header","Uint8Array","view","DataView","setUint32","decodeHeader","getUint32","message","maxSize","totalSize","byteLength","maxContentSize","Math","max","Uint32Array","crypto","getRandomValues","contentSize","min","chunk","subarray","UnChunker","this","pendingMessages","decoderFactory","headerBlob","contentBlob","arrayBuffer","pendingMessage","receivedSize","content","decoder","Error","chunkContent","decode","undefined","prettyByte","byte","concat","abs","toString","padStart","extendStatics","ExtData","type","data","__extends","d","b","setPrototypeOf","__proto__","Array","p","TypeError","String","__","constructor","create","DecodeError","_super","_this","proto","configurable","UINT32_MAX","setInt64","high","floor","low","getInt64","getInt32","_a","_b","_c","timestampExtension","encode","object","msec","sec","nsec","nsecInSec","Date","rv","secHigh","secLow","encodeTimeSpecToTimestamp","getTime","timeSpec","byteOffset","nsec30AndSecHigh2","decodeTimestampToTimeSpec","ExtensionCodec","builtInEncoders","builtInDecoders","encoders","decoders","register","tryToEncode","context","encodeExt","decodeExt","defaultCodec","TEXT_ENCODING_AVAILABLE","process","env","TextEncoder","TextDecoder","utf8Count","strLength","pos","charCodeAt","extra","sharedTextEncoder","TEXT_ENCODER_THRESHOLD","utf8EncodeTE","encodeInto","output","outputOffset","CHUNK_SIZE","utf8DecodeJs","bytes","inputOffset","end","units","result","byte1","byte2","byte3","unit","fromCharCode","sharedTextDecoder","TEXT_DECODER_THRESHOLD","ensureUint8Array","isView","from","DEFAULT_MAX_KEY_LENGTH","DEFAULT_MAX_LENGTH_PER_KEY","CachedKeyDecoder","maxKeyLength","maxLengthPerKey","hit","miss","caches","canBeCached","find","FIND_CHUNK","_i","records_1","record","recordBytes","j","store","records","random","cachedValue","slicedCopyOfBytes","__generator","thisArg","body","f","y","t","g","_","label","sent","trys","ops","next","verb","iterator","n","v","op","done","step","__asyncValues","asyncIterator","m","__values","Promise","resolve","reject","then","settle","__await","__asyncGenerator","_arguments","generator","q","a","resume","r","fulfill","HEAD_BYTE_REQUIRED","EMPTY_VIEW","EMPTY_BYTES","DataViewIndexOutOfBoundsError","getInt8","MORE_DATA","sharedCachedKeyDecoder","Decoder","extensionCodec","maxStrLength","maxBinLength","maxArrayLength","maxMapLength","maxExtLength","keyDecoder","totalPos","headByte","stack","reinitializeState","setBuffer","bufferView","createDataView","appendBuffer","hasRemaining","remainingData","newData","newBuffer","createExtraByteError","posToShow","RangeError","doDecodeSync","decodeMulti","decodeAsync","stream","stream_1","stream_1_1","e_1","P","decoded","e_1_1","return","fulfilled","rejected","decodeArrayStream","decodeMultiAsync","decodeStream","isArray","arguments","isArrayHeaderRequired","arrayItemsLeft","stream_2","stream_2_1","e_2","e_3_1","e_3","readArraySize","complete","DECODE","readHeadByte","pushMapState","pushArrayState","decodeUtf8String","readF32","readF64","readU8","readU16","readU32","readU64","readI8","readI16","readI32","readI64","lookU8","lookU16","lookU32","decodeBinary","decodeExtension","state","array","position","keyType","map","readCount","headerOffset","stateIsMapKey","stringBytes","utf8DecodeTD","headOffset","extType","getUint8","getUint16","getInt16","getFloat32","getFloat64","DEFAULT_MAX_DEPTH","DEFAULT_INITIAL_BUFFER_SIZE","Encoder","maxDepth","initialBufferSize","sortKeys","forceFloat32","ignoreUndefined","forceIntegerToFloat","encodeSharedRef","doEncode","depth","encodeNil","encodeBoolean","encodeNumber","encodeString","encodeObject","ensureBufferSizeToWrite","sizeToWrite","requiredSize","resizeBuffer","newSize","newBytes","newView","writeU8","Number","isSafeInteger","writeU16","writeU32","writeU64","writeI8","writeI16","writeI32","writeI64","writeF32","writeF64","writeStringHeader","utf8EncodeJs","ext","encodeExtension","encodeArray","encodeBinary","encodeMap","writeU8a","object_1","item","countWithoutUndefined","count","keys_1","sort","keys_2","setUint8","values","setInt8","setUint16","setInt16","setInt32","setFloat32","setFloat64","setUint64","defer","deferred","promise","secret","ws","CLIENT_ERROR","msgCount","inFlightRpc","regexRPC","clientID","MAX_MSG_SIZE","unchunker","onCompleteMessage","payload","match","exec","assert","topic","maxMsgSize","code","createDecoder","onconnect","wrapper","wslink","method","kwargs","CustomEncoder","binary","readyState","subscribe","info","splice","close","releasePendingMessages","onmessage","processChunk","addAttachment","Session","DEFAULT_SECRET","getTransportObject","idx","protocol","substring","session","retry","wsProxy","connect","urls","uriList","transports","transport","transportCreateError","fireConnectionError","WSLINK","createWebSocket","WebSocket","err","binaryType","onopen","fireConnectionReady","onclose","fireConnectionClose","getSession","getUrl","WebsocketConnection","DEFAULT_CONFIG_DECORATOR","sessionURL","replaceAll","window","location","hostname","host","DEFAULT_SESSION_MANAGER_URL","document","baseURI","DEFAULT_SESSION_URL","port","addOn","pathName","pathname","endsWith","tokens","split","extractPathName","wsConnect","wsConnection","iframe","onConnectionReady","readyForwarder","onConnectionError","errorForwarder","onConnectionClose","closeForwarder","gc","configDecorator","launcher","sessionManagerURL","onProcessReady","onError","smartConnect"],"sourceRoot":""}